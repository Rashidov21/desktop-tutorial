function siteHost(){var e=window.location.protocol,t=window.location.hostname,o=window.location.port,t=e+"//"+t;return 80!=o&&(t+=":"+o),t}var ini_recaptcha=!1,login_movie_id=0,login_favorite_id=0,login_invoked_type="",current_page=window.location.href,pathname=window.location.pathname;function notify(e){$.notify({message:e,url:""},{type:"message",placement:{from:"top",align:"right"},allow_dismiss:!1,delay:500,template:'<div data-notify="container" class="alert alert-{0}" role="alert"><span data-notify="message">{2}</span></div>'})}function reset_login_datas(){login_favorite_id=login_movie_id=0,login_invoked_type=""}function account_modal(e){$("#modal_login_content .alert-success").hide(),$("#modal_login_content .alert-danger").hide(),$("#modal_recover_content .alert-success").hide(),$("#modal_recover_content .alert-danger").hide(),$("#modal_register_content .alert-success").hide(),$("#modal_register_content .alert-danger").hide(),"register"==e?($("#account_modal .modal-title").text("Регистрация"),$("#modal_login_content").hide(),$("#modal_recover_content").hide(),$("#modal_register_content").show()):("recover"==e?($("#account_modal .modal-title").text("Восстановление пароля"),$("#modal_login_content").hide(),$("#modal_recover_content").show()):($("#account_modal .modal-title").text("Вход"),$("#modal_login_content").show(),$("#modal_recover_content").hide()),$("#modal_register_content").hide()),$("#account_modal").modal("show"),ini_recaptcha||$.getScript("https://www.google.com/recaptcha/api.js",function(e,t,o){"success"==t&&(ini_recaptcha=!0)})}var ulogin={facebook:function(e){this.openPopup("facebook",e,720,500)},vkontakte:function(e){this.openPopup("vkontakte",e,680,400)},twitter:function(e){this.openPopup("twitter",e,620,500)},odnoklassniki:function(e){this.openPopup("odnoklassniki",e,620,400)},callback:function(e){CURRENT_USER_ID=e,0<login_favorite_id&&"favorite"==login_invoked_type?$(".favorite[data-movie-id='"+login_favorite_id+"']").trigger("click"):"comment"==login_invoked_type&&$("#comment_form").submit(),(-1<pathname.indexOf("/login")||-1<pathname.indexOf("/registration")||-1<pathname.indexOf("/reset_password"))&&(current_page=siteHost()),login_invoked_type?setTimeout(function(){window.location=current_page},500):window.location=current_page},openPopup:function(e,t,o,i){var n=Math.round(screen.width/2-o/2),r=0;screen.height>i&&(r=Math.round(screen.height/3-i/2));t="https://api.cdngate.org/social/auth.php?provider="+e+"&redirect_url="+encodeURIComponent(t),i=window.open(t,"social_auth_"+e,"left="+n+",top="+r+",width="+o+",height="+i+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");i?i.focus():location.href=t}},MOVIES_URL="";function filters(){var e=[];$(".checkbox-dropdown input:checked").each(function(){e.push($(this).val())});var t=MOVIES_URL;0<e.length&&(t+="/"+e.join("_")),window.location.href=t}$(document).ready(function(){$.ajaxSetup({cache:!1}),$(document).on("click",".dropdown-filter",function(e){e.stopPropagation()}),$(".dropdown-filter .btn-save").click(function(){filters()}),$(".dropdown-filter .btn-clear").click(function(){$(this).closest(".checkbox-dropdown").find("input:checked").removeAttr("checked"),filters()});var e=$("#wrapper").height();$("#sidebar").css({"min-height":e}),$("#autocomplete_search").autocomplete({noCache:!0,type:"POST",paramName:"query",serviceUrl:"/search",width:"400",minChars:2,deferRequestBy:200,preventBadQueries:!1,triggerSelectOnValidInput:!1,onSelect:function(e){window.location.href=e.url},formatResult:function(e,t){return e.value}}),$("#page_search").autocomplete({noCache:!0,type:"POST",paramName:"query",serviceUrl:"/search",minChars:2,deferRequestBy:200,preventBadQueries:!1,triggerSelectOnValidInput:!1,onSelect:function(e){window.location.href=e.url},formatResult:function(e,t){return e.value}}),$("#autocomplete_search_form").submit(function(e){if(!$("#autocomplete_search").val())return $("#autocomplete_search").focus(),!1}),$("#page_search_form").submit(function(e){if(!$("#page_search").val())return $("#page_search").focus(),!1}),$("#toggle_genres").click(function(){$(".sidebar_genre").toggle()}),$("#toggle_countries").click(function(){$(".sidebar_country").toggle()}),$("#toggle_years").click(function(){$(".sidebar_year").toggle()}),$(".sidebar-login").click(function(){return reset_login_datas(),account_modal("login"),!1}),$(".sidebar-register").click(function(){return reset_login_datas(),account_modal("register"),!1}),$(".login").click(function(){return account_modal("login"),!1}),$(".recover").click(function(){return account_modal("recover"),!1}),$(".register").click(function(){return account_modal("register"),!1}),$("#modal_login_form").submit(function(){var n=$(this).find("button");return n.attr("disabled","disabled"),$.post("/login",$(this).serialize(),function(e){if(n.removeAttr("disabled"),e){var t=jQuery.parseJSON(e);if("success"==t.type)CURRENT_USER_ID=t.user_id,0<login_favorite_id&&"favorite"==login_invoked_type?$(".favorite[data-movie-id='"+login_favorite_id+"']").trigger("click"):"comment"==login_invoked_type&&$("#comment_form").submit(),(-1<pathname.indexOf("/login")||-1<pathname.indexOf("/registration")||-1<pathname.indexOf("/reset_password"))&&(current_page=siteHost()),login_invoked_type?setTimeout(function(){window.location=current_page},500):window.location=current_page;else if("error"==t.type){$("#modal_login_content .alert-success").hide();var o,i=$("#modal_login_content .alert-danger");for(o in i.empty(),t.msg)i.append("<p>"+t.msg[o]+"</p>");i.show()}}}),!1}),$("#modal_register_form").submit(function(){var n=$(this).find("button");return n.attr("disabled","disabled"),$.post("/registration",$(this).serialize(),function(e){if(n.removeAttr("disabled"),e){var t=jQuery.parseJSON(e);if("success"==t.type)CURRENT_USER_ID=t.user_id,0<login_favorite_id&&"favorite"==login_invoked_type?$(".favorite[data-movie-id='"+login_favorite_id+"']").trigger("click"):"comment"==login_invoked_type&&$("#comment_form").submit(),(-1<pathname.indexOf("/login")||-1<pathname.indexOf("/registration")||-1<pathname.indexOf("/reset_password"))&&(current_page=siteHost()),login_invoked_type?setTimeout(function(){window.location=current_page},500):window.location=current_page;else if("error"==t.type){grecaptcha.reset(),$("#modal_register_content .alert-success").hide();var o,i=$("#modal_register_content .alert-danger");for(o in i.empty(),t.msg)i.append("<p>"+t.msg[o]+"</p>");i.show()}}}),!1}),$("#modal_recover_form").submit(function(){var o=$(this).find("button");return o.attr("disabled","disabled"),$.post("/recover",$(this).serialize(),function(e){var t;o.removeAttr("disabled"),e&&("success"==(e=jQuery.parseJSON(e)).type?($("#modal_recover_content .alert-danger").hide(),(t=$("#modal_recover_content .alert-success")).html("<p>"+e.msg+"</p>"),t.show()):"error"==e.type&&($("#modal_recover_content .alert-success").hide(),(t=$("#modal_recover_content .alert-danger")).html("<p>"+e.msg+"</p>"),t.show()))}),!1}),$(".favorite").click(function(){var e=$(".btn-fav"),t=$(this),o=t.hasClass("is-favorited"),i=t.attr("data-movie-id");return CURRENT_USER_ID<=0?(login_favorite_id=i,login_invoked_type="favorite",$("#modal_login_content").show(),void account_modal()):(o?$.post("/delete_favorite",{movie_id:i}).done(function(){notify("Контент удален из избранного"),t.removeClass("is-favorited"),t.css({display:""}),t.attr("title","Добавить в избранное"),e.attr("title","Добавить в избранное"),e.text("В избранное"),e.removeClass("is-favorited")}):$.post("/add_favorite",{movie_id:i}).done(function(){notify("Контент добавлен в избранное"),t.addClass("is-favorited"),t.css({display:"block"}),t.attr("title","Удалить из избранного"),e.attr("title","Удалить из избранного"),e.text("В избранном"),e.addClass("is-favorited")}),!1)})});
